<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magento.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magento.com for more information.
 *
 * @category    design
 * @package     rwd_default
 * @copyright   Copyright (c) 2006-2017 X.commerce, Inc. and affiliates (http://www.magento.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */

/**
 * Product view template
 *
 * @see Mage_Catalog_Block_Product_View
 * @see Mage_Review_Block_Product_View
 */
?>
<?php $_helper = $this->helper('catalog/output'); ?>
<?php 
	$_product = $this->getProduct(); 
	$customLayoutFlag = $_product->getData('update_layout');
	//Will change layout depend on this flag (0: keep original layout, 1: new layout)
?>

<?php if ($customLayoutFlag == 0) : ?>					
	<?php $code = $_product->getSku(); ?>
	<?php $store = Mage::app()->getStore(); ?>
	<?php $sname = $store->getName(); ?>
	<script type="text/javascript">
		var optionsPrice = new Product.OptionsPrice(<?php echo $this->getJsonConfig() ?>);
	</script>
	<script>
	jQuery(document).ready(function($){
		$('.category-wood #qty').val('10');
	});
	jQuery(document).ready(function($){
		$('.categorypath-products-bill-presenters-wood-html #qty').val('5');
	});
	</script>
	<div id="messages_product_view"><?php echo $this->getMessagesBlock()->toHtml() ?></div>
	<div class="product-view">
		
		<div class="product-essential">
			<form action="<?php echo $this->getSubmitUrl($_product, array('_secure' => $this->_isSecure())) ?>" method="post" id="product_addtocart_form"<?php if($_product->getOptions()): ?> enctype="multipart/form-data"<?php endif; ?>>
				<?php echo $this->getBlockHtml('formkey') ?>
				<div class="no-display">
					<input type="hidden" name="product" value="<?php echo $_product->getId() ?>" />
					<input type="hidden" name="related_product" id="related-products-field" value="" />
				</div>

				<div class="product-img-box">
					<div class="product-name">
						<h1><?php echo $_helper->productAttribute($_product, $_product->getName(), 'name') ?></h1>
					</div>
					<?php echo $this->getChildHtml('media') ?>
				</div>

				<div class="product-shop">

					<div class="product-name">
						<span class="h1"><?php echo $_helper->productAttribute($_product, $_product->getName(), 'name') ?></span>
					</div>

					<div class="row clearfix">
					<div class="col-md-6">
					<div class="product-sku">
					<?php echo $code; ?>
					</div>
					</div>
					<div class="col-md-6">
					<div class="price-info">
					<?php echo $this->__('From') ?>:
						<?php echo $this->getPriceHtml($_product); ?>
						<?php echo $this->getChildHtml('bundle_prices') ?>
						<?php if (Mage::helper('not2order')->getShowPrice($_product)) : ?>
<?php echo $this->getTierPriceHtml() ?>
<?php endif; ?>
					</div>
					</div>
					</div>

					<div class="extra-info">
						<?php echo $this->getReviewsSummaryHtml($_product, 'default', false)?>
						<?php echo $this->getChildHtml('product_type_availability'); ?>
					</div>

					<?php echo $this->getChildHtml('alert_urls') ?>

					<?php if ($_product->getShortDescription()):?>
						<div class="short-description">
							<div class="std"><p class="desc-header"><strong><?php echo $this->__('Additional Information') ?></strong></p><?php echo $_helper->productAttribute($_product, nl2br($_product->getShortDescription()), 'short_description') ?><?php echo $_helper->productAttribute($_product, nl2br($_product->getDescription()), 'description') ?></div>
						</div>
					<?php endif;?>




					<?php echo $this->getChildHtml('other');?>

					<?php if ($_product->isSaleable() && $this->hasOptions()):?>
						<?php echo $this->getChildChildHtml('container1', '', true, true) ?>
					<?php endif;?>
					<?php $vid = $_product->getVideolink(); ?>
					<?php if($vid && $vid != ''){
						?>
						<div class="videoWrapper">
							<iframe width="430" height="242" src="https://www.youtube.com/embed/<?php echo $vid; ?>" frameborder="0" allowfullscreen></iframe>
						</div>
						<?php
					}
					?>
					
				</div>
				
				<div class="add-to-cart-wrapper">
					<?php echo $this->getChildHtml('product_type_data') ?>
					<?php echo $this->getChildHtml('extrahint') ?>
					
					<?php echo $this->getChildHtml('addtocart') ?>
					<?php if (!$this->hasOptions()):?>
						<div class="add-to-box">
							<?php if($_product->isSaleable()): ?>
								<?php echo $this->getChildHtml('addtocart') ?>
								<?php if( $this->helper('wishlist')->isAllow() || $_compareUrl=$this->helper('catalog/product_compare')->getAddUrl($_product)): ?>
									<span class="or"><?php echo $this->__('OR') ?></span>
								<?php endif; ?>
							<?php endif; ?>
							<?php echo $this->getChildHtml('addto') ?>
							<?php echo $this->getChildHtml('sharing') ?>
						</div>
						<?php echo $this->getChildHtml('extra_buttons') ?>
					<?php elseif (!$_product->isSaleable()): ?>
						<div class="add-to-box">
							<?php echo $this->getChildHtml('addto') ?>
							<?php echo $this->getChildHtml('sharing') ?>
						</div>
					<?php endif; ?>
					
					
				</div>



				<?php echo $this->getChildHtml('related_products') ?>

				<div class="clearer"></div>
				<?php if ($_product->isSaleable() && $this->hasOptions()):?>
					<?php echo $this->getChildChildHtml('container2', '', true, true) ?>
				<?php endif;?>
			</form>
			<script type="text/javascript">
			//<![CDATA[
				var productAddToCartForm = new VarienForm('product_addtocart_form');
				productAddToCartForm.submit = function(button, url) {
					if (this.validator.validate()) {
						var form = this.form;
						var oldUrl = form.action;

						if (url) {
						   form.action = url;
						}
						var e = null;
						try {
							this.form.submit();
						} catch (e) {
						}
						this.form.action = oldUrl;
						if (e) {
							throw e;
						}

						if (button && button != 'undefined') {
							button.disabled = true;
						}
					}
				}.bind(productAddToCartForm);

				productAddToCartForm.submitLight = function(button, url){
					if(this.validator) {
						var nv = Validation.methods;
						delete Validation.methods['required-entry'];
						delete Validation.methods['validate-one-required'];
						delete Validation.methods['validate-one-required-by-name'];
						// Remove custom datetime validators
						for (var methodName in Validation.methods) {
							if (methodName.match(/^validate-datetime-.*/i)) {
								delete Validation.methods[methodName];
							}
						}

						if (this.validator.validate()) {
							if (url) {
								this.form.action = url;
							}
							this.form.submit();
						}
						Object.extend(Validation.methods, nv);
					}
				}.bind(productAddToCartForm);
			//]]>
			</script>
		</div>

		<div class="product-collateral toggle-content tabs">
			<?php if ($detailedInfoGroup = $this->getChildGroup('detailed_info', 'getChildHtml')):?>
				<dl id="collateral-tabs" class="collateral-tabs">
					<?php foreach ($detailedInfoGroup as $alias => $html):?>
						<dt class="tab"><span><?php echo $this->escapeHtml($this->getChildData($alias, 'title')) ?></span></dt>
						<dd class="tab-container">
							<div class="tab-content"><?php echo $html ?></div>
						</dd>
					<?php endforeach;?>
				</dl>
			<?php endif; ?>
		</div>

		<?php echo $this->getChildHtml('upsell_products') ?>
		<?php echo $this->getChildHtml('product_additional_data') ?>

	</div>
<?php else : ?>
	<script>
		jQuery(document).ready(function($){
			$('.col-main').css('width', '100%');
			$('.qty-wrapper #qty').val(10);
		});
	</script>
	<?php $store = Mage::app()->getStore(); ?>
	<?php $sname = $store->getName(); ?>
	<?php $sku = $_product->getSku(); ?>
	<?php //$currency_symbol = Mage::app()->getLocale()->currency( $currency_code )->getSymbol(); ?>
	<?php $currency_symbol = Mage::app()->getLocale()->currency(Mage::app()->getStore()->getCurrentCurrencyCode())->getSymbol(); ?>
	<?php 
		$product = Mage::getModel('catalog/product');
		$productId = $product->getIdBySku($_product->getSku());
		$product->load($productId);
		$productAttributeOptions = $product->getTypeInstance(true)->getConfigurableAttributesAsArray($product);
		$attributeOptions = array();
		foreach ($productAttributeOptions as $productAttribute) {
			foreach ($productAttribute['values'] as $attribute) {
				$attributeOptions[$productAttribute['label']][$attribute['value_index']] = $attribute['store_label'];
			}
		}
		$spConfig_Sp = array();
		foreach ($attributeOptions["Paper Size"] as $k => $v) {
			$childProducts = Mage::getModel('catalog/product_type_configurable')                        
                ->getUsedProductCollection($product)
                ->addAttributeToSelect('*')
				->addFieldToFilter('size', array('eq' => $k));
			foreach ($childProducts as $child) {
				$childProduct = Mage::getModel('catalog/product');
				$childProduct->load($child->getId());
				$baseCurrencyCode = Mage::app()->getStore()->getBaseCurrencyCode(); 
				$currentCurrencyCode = Mage::app()->getStore()->getCurrentCurrencyCode();
				
				$spConfig_Sp[$k][$childProduct->getData('fixing_style')]['price'] = Mage::helper('directory')->currencyConvert($childProduct->getPrice(), $baseCurrencyCode, $currentCurrencyCode);
				$spConfig_Sp[$k][$childProduct->getData('fixing_style')]['sku'] = $childProduct->getSku();
			}
		}
	?>

	<script type="text/javascript">
		var optionsPrice = new Product.OptionsPrice(<?php echo $this->getJsonConfig() ?>);
		var spConfig_Sp = <?php echo json_encode($spConfig_Sp); ?>;
	</script>
	<div id="messages_product_view"><?php echo $this->getMessagesBlock()->toHtml() ?></div>
	<div class="product-view customlayout">
		
		
		<div class="product-essential">
			<form action="<?php echo $this->getSubmitUrl($_product, array('_secure' => $this->_isSecure())) ?>" method="post" id="product_addtocart_form"<?php if($_product->getOptions()): ?> enctype="multipart/form-data"<?php endif; ?>>
				<?php echo $this->getBlockHtml('formkey') ?>
				<div class="no-display">
					<input type="hidden" name="product" value="<?php echo $_product->getId() ?>" />
					<input type="hidden" name="related_product" id="related-products-field" value="" />
				</div>
				<div class="product-img-box">
					<?php echo $this->getChildHtml('media') ?>
				</div>
				<div class="product-shop">
					<div class="product-name">
						<span class="h1"><?php echo $_helper->productAttribute($_product, $_product->getName(), 'name') ?></span>
					</div>
					<div class="row clearfix">
						<div class="col-md-6">
							<div class="product-sku">
								<label>SKU1:</label><label id="sku_text"><?php echo $_product->getSku(); ?></label>
							</div>
						</div>
						<div class="col-md-6">
						</div>
					</div>

					<div class="extra-info">
						<?php echo $this->getReviewsSummaryHtml($_product, 'default', false)?>
						<?php echo $this->getChildHtml('product_type_availability'); ?>
					</div>
					<?php if ($_product->getShortDescription()):?>
						<div class="short-description">
							<div class="std"><p class="desc-header"><strong><?php echo $this->__('Additional Information') ?></strong></p><?php echo $_helper->productAttribute($_product, nl2br($_product->getShortDescription()), 'short_description') ?><?php echo $_helper->productAttribute($_product, nl2br($_product->getDescription()), 'description') ?></div>
						</div>
					<?php endif;?>
				</div>

				<?php if (count($product->getOptions()) > 0) : ?>
					<div class="custom-options">
						<div class="options-header">
							<h2>Build Your Items</h2>
							<?php
								$outerMaterialArray = array();
								$innerMaterialArray = array();
								$trimArray = array();
								$cornerProtectorArray = array();
								$personalisationArray = array();
								$foilStandardArray = array();
								$foilEmbossedArray = array();
								$outerMaterialOptionId = 0;
								$innerMaterialOptionId = 0;
								$trimOptionId = 0;
								$cornerProtectorOptionId = 0;
								$personalisationOptionId = 0;
								$foilStandardOptionId = 0;
								$foilEmbossedOptionId = 0;
								$additionalNoteOptionId = 0;
								$values = '';
								$fixingStyle = '';
								$paperSize = '';
								$totalCount = count($product->getOptions());
								foreach ($product->getOptions() as $o) {
									if ($o->getTitle() === 'Outer Material Colour') {
										$outerMaterialOptionId = $o->getId();
										$outerMaterialArray = $o->getValues();
									} else if ($o->getTitle() === 'Inner Material Colour') {
										$innerMaterialOptionId = $o->getId();
										$innerMaterialArray = $o->getValues();

                                    } else if ($o->getTitle() === 'Trim Colour') {
                                        $trimOptionId = $o->getId();
                                        $trimArray = $o->getValues();

									} else if ($o->getTitle() === 'Corner Protectors') {
										$cornerProtectorOptionId = $o->getId();
										$cornerProtectorArray = $o->getValues();
									} else if ($o->getTitle() === 'Persionalisation') {
										$personalisationOptionId = $o->getId();
										$personalisationArray = $o->getValues();
									} else if ($o->getTitle() === 'Additional Notes') {
										$additionalNoteOptionId = $o->getId();
									} else if ($o->getTitle() === 'Foil Colour Standard Text') {
										$foilStandardOptionId = $o->getId();
										$foilStandardArray = $o->getValues();
									} else if ($o->getTitle() === 'Foil Colour/Embossed Logo') {
										$foilEmbossedOptionId = $o->getId();
										$foilEmbossedArray = $o->getValues();
									}
								}
							?>
							<script type="text/javascript">
								<?php
									echo "var outerMaterialOptionId = '{$outerMaterialOptionId}';".PHP_EOL;
									echo "var innerMaterialOptionId = '{$innerMaterialOptionId}';".PHP_EOL;
									echo "var cornerProtectorOptionId = '{$cornerProtectorOptionId}';".PHP_EOL;
									echo "var personalisationOptionId = '{$personalisationOptionId}';".PHP_EOL;
									echo "var additionalNoteOptionId = '{$additionalNoteOptionId}';".PHP_EOL;
									echo "var foilStandardOptionId = '{$foilStandardOptionId}';".PHP_EOL;
									echo "var foilEmbossedOptionId = '{$foilEmbossedOptionId}';".PHP_EOL;
									echo "var totalCount = '{$totalCount}';".PHP_EOL;
									echo "var index = 0;".PHP_EOL;
									echo "var origsku = '{$sku}';".PHP_EOL;
									echo "var currency_symbol = '{$currency_symbol}';".PHP_EOL;
									echo "var totalPrice = 0;".PHP_EOL;
									echo "var fixedStylePrice = 0;".PHP_EOL;
									echo "var cornerPrice = 0;".PHP_EOL;
									echo "var personalisationPrice = 0;".PHP_EOL;
								?>
							</script>

							<?php if (count($attributeOptions["Paper Size"]) > 0) : ?>
							<div class="row paper-size">
								<h4>Paper Size</h4>
								<ul class="items">
								<?php foreach ($attributeOptions["Paper Size"] as $k => $v) : ?>
									<li class="item" name="<?php echo $v; ?>" id="<?php echo 'paper_size'.$k; ?>">
										<?php
											$url = Mage::getBaseUrl('skin').'custom_option/paper_size/'.$v.'.jpg';
										?>
										<img class="thumb-item" src="<?php echo $url; ?>">
									</li>
								<?php endforeach; ?>
								</ul>
								<script>
								function triggerEvent(element, eventName) {
									  // safari, webkit, gecko
									  if (document.createEvent)
									  {
										var evt = document.createEvent('HTMLEvents');
										evt.initEvent(eventName, true, true);

										return element.dispatchEvent(evt);
									  }

									  // Internet Explorer
									  if (element.fireEvent) {
										return element.fireEvent('on' + eventName);
									  }
								}
								</script>
								<script>
									jQuery(document).ready(function($){
										$('.paper-size .item').hover(function ($) {
											jQuery('.paper-size .item').removeClass('hovered');
											jQuery(this).addClass('hovered');
										});
										$('.paper-size .item').mouseleave(function ($) {
											jQuery('.paper-size .item').removeClass('hovered');
										});
										$('.paper-size .item').click(function ($) {
											var value = jQuery(this).attr('id').replace("paper_size", "");
											jQuery('#attribute132').val(value);
											triggerEvent($$("select[id^=attribute132]")[0],'change');
											opConfig.reloadPrice();
											jQuery('.paper-size .item').removeClass('selected');
											jQuery(this).addClass('selected');
											jQuery('.fixing-style').show();
											jQuery('.fixing-style .item').hide();
											var items = jQuery('#attribute142').children();
											for (var i = 0; i < items.length; i++) {
												var fixing_value = items.eq(i).val();
												if (fixing_value == '') {
													continue;
												} else {
													var elementId = 'fixing_style' + fixing_value;
													jQuery('#'+elementId).show();
													var price = spConfig_Sp[value][fixing_value]['price'];
													jQuery('#'+elementId).find('.thumb-price').eq(0).html(currency_symbol + parseFloat(price).toFixed(2));
												}
											}
											
										});
									});
								</script>
							</div>
							<?php endif; ?>

							<?php if (count($attributeOptions["Fixing Style"]) > 0) : ?>
							<div class="row fixing-style">
								<h4>Fixing Style</h4>
								<ul class="items">
								<?php foreach ($attributeOptions["Fixing Style"] as $k => $v) : ?>
									<li class="item" name="<?php echo $v; ?>" id="<?php echo 'fixing_style'.$k; ?>">
										<?php
											$url = Mage::getBaseUrl('skin').'custom_option/fixing_style/'.$v.'.jpg';
										?>
										<img class="thumb-item" src="<?php echo $url; ?>">
										<span class="thumb-price"></span>
									</li>
								<?php endforeach; ?>
								</ul>
								<script>
									jQuery(document).ready(function($){
										$('.fixing-style .item').hover(function ($) {
											jQuery('.fixing-style .item').removeClass('hovered');
											jQuery(this).addClass('hovered');
										});
										$('.fixing-style .item').mouseleave(function ($) {
											jQuery('.fixing-style .item').removeClass('hovered');
										});
										$('.fixing-style .item').click(function ($) {
											var value = jQuery(this).attr('id').replace("fixing_style", "");
											jQuery('#attribute142').val(value);
											triggerEvent($$("select[id^=attribute142]")[0],'change');
											opConfig.reloadPrice();
											jQuery('.fixing-style .item').removeClass('selected');
											jQuery(this).addClass('selected');
											
											if (index == totalCount) {
												jQuery('.add-to-cart-wrapper').show();
											} else {
												jQuery('.custom-options .row').eq(index + 2).show();
												index++;
											}
											
											var paper_value = jQuery('.paper-size .item.selected').attr('id').replace("paper_size", "");
											jQuery('#sku_text').html(spConfig_Sp[paper_value][value]['sku']);
											fixedStylePrice = spConfig_Sp[paper_value][value]['price'];
											totalPrice = parseFloat(fixedStylePrice) + parseFloat(cornerPrice) + parseFloat(personalisationPrice);
											jQuery('#totalPrice').html(parseFloat(totalPrice).toFixed(2));
											jQuery('#custom_total_price').val(parseFloat(totalPrice).toFixed(2));
											jQuery('.regular-price .price').html(parseFloat(totalPrice).toFixed(2));
										});
									});
								</script>
							</div>
							<?php endif; ?>
							<?php if ($outerMaterialOptionId > 0) : ?>
							<div class="row outer-material">
								<h4>Outer Material Colour</h4>
								<ul class="items slides">
								<?php foreach ($outerMaterialArray as $k => $v) : ?>
									<li class="item" id="<?php echo $v->getId(); ?>">
										<?php
											$url = Mage::getBaseUrl('skin').'custom_option/material/'.$v->getTitle().'.jpg';
										?>
										<img class="thumb-item" src="<?php echo $url; ?>">
										<a class="btn-enlarge"><span>Enlarge</span></a>
									</li>
								<?php endforeach; ?>
								</ul>
								<script>
									jQuery(document).ready(function($){
										$('.outer-material .item .thumb-item').hover(function ($) {
											jQuery('.outer-material .item').removeClass('hovered');
											jQuery(this).parent().addClass('hovered');
										});
										$('.outer-material .item .thumb-item').mouseleave(function ($) {
											jQuery('.outer-material .item').removeClass('hovered');
										});
										$('.outer-material .item .thumb-item').click(function ($) {
											var outerMaterialSelectObjId = '#select_' + outerMaterialOptionId;
											jQuery(outerMaterialSelectObjId).val(jQuery(this).parent().attr('id'));
											opConfig.reloadPrice();
											jQuery('.outer-material .item').removeClass('selected');
											jQuery(this).parent().addClass('selected');
											//jQuery('.inner-material').show();
											if (index == totalCount) {
												jQuery('.add-to-cart-wrapper').show();
											} else {
												jQuery('.custom-options .row').eq(index + 2).show();
												index++;
											}
										});
										$('.btn-enlarge').click(function ($) {
											var imageSrc = jQuery(this).parent().find('.thumb-item').eq(0).attr('src');
											jQuery('#enlarge-thumbnail-image').attr('src', imageSrc);
											jQuery('.thumbnail-modal').css('visibility', 'visible');
										});
										$('#close-button-thumbnail').click(function (e) {
											e.preventDefault();
											jQuery('.thumbnail-modal').css('visibility', 'hidden');
										});
									});
								</script>
							</div>
							<?php endif; ?>
							<?php if ($innerMaterialOptionId > 0) : ?>
							<div class="row inner-material">
								<h4>Inner Material Colour</h4>
								<ul class="items slides">
								<?php foreach ($innerMaterialArray as $k => $v) : ?>
									<li class="item" id="<?php echo $v->getId(); ?>">
										<?php
											$url = Mage::getBaseUrl('skin').'custom_option/material/'.$v->getTitle().'.jpg';
											/*if (!getImageSize($url)) {
												$url = Mage::getBaseUrl('skin').'custom_option/material/'.$v->getTitle().'.png';
											}*/
										?>
										<img class="thumb-item" src="<?php echo $url; ?>">
										<a class="btn-enlarge"><span>Enlarge</span></a>
									</li>
								<?php endforeach; ?>
								</ul>
								<script>
									jQuery(document).ready(function($){
										$('.inner-material .item').hover(function ($) {
											jQuery('.inner-material .item').removeClass('hovered');
											jQuery(this).addClass('hovered');
										});
										$('.inner-material .item').mouseleave(function ($) {
											jQuery('.inner-material .item').removeClass('hovered');
										});
										$('.inner-material .item').click(function ($) {
											var innerMaterialSelectObjId = '#select_' + innerMaterialOptionId;
											jQuery(innerMaterialSelectObjId).val(jQuery(this).attr('id'));
											opConfig.reloadPrice();
											jQuery('.inner-material .item').removeClass('selected');
											jQuery(this).addClass('selected');
											//jQuery('.corner-protector').show();
											if (index == totalCount) {
												jQuery('.add-to-cart-wrapper').show();
											} else {
												jQuery('.custom-options .row').eq(index + 2).show();
												index++;
											}
										});
									});
								</script>
							</div>
							<?php endif; ?>
<!--tom trim color                      -->
                            <?php if ($innerMaterialOptionId > 0) : ?>
                                <div class="row inner-material">
                                    <h4>Inner Material Colour</h4>
                                    <ul class="items slides">
                                        <?php foreach ($innerMaterialArray as $k => $v) : ?>
                                            <li class="item" id="<?php echo $v->getId(); ?>">
                                                <?php
                                                $url = Mage::getBaseUrl('skin').'custom_option/material/'.$v->getTitle().'.jpg';
                                                /*if (!getImageSize($url)) {
                                                    $url = Mage::getBaseUrl('skin').'custom_option/material/'.$v->getTitle().'.png';
                                                }*/
                                                ?>
                                                <img class="thumb-item" src="<?php echo $url; ?>">
                                                <a class="btn-enlarge"><span>Enlarge</span></a>
                                            </li>
                                        <?php endforeach; ?>
                                    </ul>
                                    <script>
                                        jQuery(document).ready(function($){
                                            $('.inner-material .item').hover(function ($) {
                                                jQuery('.inner-material .item').removeClass('hovered');
                                                jQuery(this).addClass('hovered');
                                            });
                                            $('.inner-material .item').mouseleave(function ($) {
                                                jQuery('.inner-material .item').removeClass('hovered');
                                            });
                                            $('.inner-material .item').click(function ($) {
                                                var innerMaterialSelectObjId = '#select_' + innerMaterialOptionId;
                                                jQuery(innerMaterialSelectObjId).val(jQuery(this).attr('id'));
                                                opConfig.reloadPrice();
                                                jQuery('.inner-material .item').removeClass('selected');
                                                jQuery(this).addClass('selected');
                                                //jQuery('.corner-protector').show();
                                                if (index == totalCount) {
                                                    jQuery('.add-to-cart-wrapper').show();
                                                } else {
                                                    jQuery('.custom-options .row').eq(index + 2).show();
                                                    index++;
                                                }
                                            });
                                        });
                                    </script>
                                </div>
                            <?php endif; ?>
<!--                        -->
							<?php if ($cornerProtectorOptionId > 0) : ?>
							<div class="row corner-protector">
								<h4>Corner Protectors</h4>
								<ul class="items">
								<?php foreach ($cornerProtectorArray as $k => $v) : ?>
									<li class="item" id="<?php echo $v->getId(); ?>">
										<?php
											$url = Mage::getBaseUrl('skin').'custom_option/corner_protectors/'.$v->getTitle().'.jpg';
										?>
										<img class="thumb-item" src="<?php echo $url; ?>">
										<span class="thumb-price"><?php echo '+'.$currency_symbol.number_format((float) Mage::helper('directory')->currencyConvert($v->getPrice(), $baseCurrencyCode, $currentCurrencyCode), 2, '.', ''); ?></span>
									</li>
								<?php endforeach; ?>
								</ul>
								<script>
									jQuery(document).ready(function($){
										$('.corner-protector .item').hover(function ($) {
											jQuery('.corner-protector .item').removeClass('hovered');
											jQuery(this).addClass('hovered');
										});
										$('.corner-protector .item').mouseleave(function ($) {
											jQuery('.corner-protector .item').removeClass('hovered');
										});
										$('.corner-protector .item').click(function ($) {
											var cornerProtectorSelectObjId = '#select_' + cornerProtectorOptionId;
											jQuery(cornerProtectorSelectObjId).val(jQuery(this).attr('id'));
											opConfig.reloadPrice();
											jQuery('.corner-protector .item').removeClass('selected');
											jQuery(this).addClass('selected');
											//jQuery('.personalisation').show();
											if (index == totalCount) {
												jQuery('.add-to-cart-wrapper').show();
											} else {
												jQuery('.custom-options .row').eq(index + 2).show();
												index++;
											}
											cornerPrice = parseFloat(jQuery(this).find('.thumb-price').html().slice(2));
											totalPrice = parseFloat(fixedStylePrice) + parseFloat(cornerPrice) + parseFloat(personalisationPrice);
											jQuery('#totalPrice').html(parseFloat(totalPrice).toFixed(2));
											jQuery('#custom_total_price').val(parseFloat(totalPrice).toFixed(2));
											jQuery('.regular-price .price').html(parseFloat(totalPrice).toFixed(2));
										});
									});
								</script>
							</div>
							<?php endif; ?>
							
							<input type="hidden" id="foil_print_branding" name="foil_print_branding" value="0" />
							<input type="hidden" name="custom_layout" id="custom_layout" value="1" />
							<?php if ($personalisationOptionId > 0) : ?>
							<div class="row personalisation">
								<h4>Personalisation</h4>
								<ul class="items">
								<?php foreach ($personalisationArray as $k => $v) : ?>
									<li class="item" name="<?php echo $v->getTitle(); ?>" id="<?php echo $v->getId(); ?>">
										<?php
											$url = Mage::getBaseUrl('skin').'custom_option/personalisation/'.$v->getTitle().'.jpg';
										?>
										<img class="thumb-item" src="<?php echo $url; ?>">
										<span class="thumb-price">
											<span class="real-price"><?php echo '+'.$currency_symbol.number_format((float) Mage::helper('directory')->currencyConvert($v->getPrice(), $baseCurrencyCode, $currentCurrencyCode), 2, '.', ''); ?></span>
											<?php if ($v->getTitle() == 'Foil Print') : ?>
											(Set Up Charge)
											<?php endif; ?>
										</span>
									</li>
								<?php endforeach; ?>
								</ul>
								<script>
									jQuery(document).ready(function($){
										$('.personalisation .item').hover(function ($) {
											jQuery('.personalisation .item').removeClass('hovered');
											jQuery(this).addClass('hovered');
										});
										$('.personalisation .item').mouseleave(function ($) {
											jQuery('.personalisation .item').removeClass('hovered');
										});
										$('.personalisation .item').click(function ($) {
											var personalSelectObjId = '#select_' + personalisationOptionId;
											jQuery(personalSelectObjId).val(jQuery(this).attr('id'));
											opConfig.reloadPrice();
											jQuery('.personalisation .item').removeClass('selected');
											jQuery(this).addClass('selected');
											var optionName = jQuery(this).attr('name');
											if (optionName === 'Standard Text') {
												jQuery('.foilColourStandard').show();
												jQuery('.foilColourEmbossed').hide();
												jQuery('#foil_print_branding').val(0);
											} else if (optionName === 'Foil Print') {
												jQuery('.foilColourEmbossed').show();
												jQuery('.foilColourStandard').hide();
												jQuery('#foil_print_branding').val(1);
											} else {
												jQuery('.foilColourStandard').hide();
												jQuery('.foilColourEmbossed').hide();
												jQuery('.add-to-cart-wrapper').show();
												if (index == totalCount) {
													jQuery('.add-to-cart-wrapper').show();
												} else {
													jQuery('.custom-options .row').eq(index + 2).show();
													index++;
												}
												jQuery('#foil_print_branding').val(0);
											}
											//personalisationPrice = parseFloat(jQuery(this).find('.thumb-price').html().slice(2));
											personalisationPrice = parseFloat(jQuery(this).find('.thumb-price .real-price').html().slice(2));
											totalPrice = parseFloat(fixedStylePrice) + parseFloat(cornerPrice) + parseFloat(personalisationPrice);
											jQuery('#totalPrice').html(parseFloat(totalPrice).toFixed(2));
											jQuery('#custom_total_price').val(parseFloat(totalPrice).toFixed(2));
											jQuery('.regular-price .price').html(parseFloat(totalPrice).toFixed(2));
										});
									});
								</script>
							</div>
							<?php endif; ?>
							<?php if ($foilStandardOptionId > 0) : ?>
							<div class="foilColourStandard">
								<h4>Foil Colour</h4>
								<ul class="items">
								<?php foreach ($foilStandardArray as $k => $v) : ?>
									<li class="item" name="<?php echo $v; ?>" id="<?php echo $v->getId(); ?>">
										<?php
											$url = Mage::getBaseUrl('skin').'custom_option/foilstandard/'.$v->getTitle().'.jpg';
											/*if (!getImageSize($url)) {
												$url = Mage::getBaseUrl('skin').'custom_option/foilstandard/'.$v->getTitle().'.png';
											}*/ 
											//$url = 'https://www.worldwidemenus.com/skin/custom_option/personalisation/Standard Text.jpg';
										?>
										<img class="thumb-item" src="<?php echo $url; ?>">
										<span class="thumb-price"><?php echo '+'.$currency_symbol.number_format((float) Mage::helper('directory')->currencyConvert($v->getPrice(), $baseCurrencyCode, $currentCurrencyCode), 2, '.', ''); ?></span>
									</li>
								<?php endforeach; ?>
								</ul>
								<script>
									jQuery(document).ready(function($){
										$('.foilColourStandard .item').hover(function ($) {
											jQuery('.foilColourStandard .item').removeClass('hovered');
											jQuery(this).addClass('hovered');
										});
										$('.foilColourStandard .item').mouseleave(function ($) {
											jQuery('.foilColourStandard .item').removeClass('hovered');
										});
										$('.foilColourStandard .item').click(function ($) {
											var foilSelectObjId = '#select_' + foilStandardOptionId;
											jQuery(foilSelectObjId).val(jQuery(this).attr('id'));
											opConfig.reloadPrice();
											jQuery('.foilColourStandard .item').removeClass('selected');
											jQuery(this).addClass('selected');
											//jQuery('.additional-note').show();
											jQuery('.add-to-cart-wrapper').show();
											if (index == totalCount) {
												jQuery('.add-to-cart-wrapper').show();
											} else {
												jQuery('.custom-options .row').eq(index + 2).show();
												index++;
											}
										});
									});
								</script>
							</div>
							<?php endif; ?>
							<?php if ($foilEmbossedOptionId > 0) : ?>
							
							<div class="foilColourEmbossed">
								<h4>Foil Colour</h4>
								<ul class="items">
								<?php foreach ($foilEmbossedArray as $k => $v) : ?>
									<li class="item" name="<?php echo $v; ?>" id="<?php echo $v->getId(); ?>">
										<?php
											$url = Mage::getBaseUrl('skin').'custom_option/foilembossed/'.$v->getTitle().'.jpg';
											//$url = 'https://www.worldwidemenus.com/skin/custom_option/personalisation/Standard Text.jpg';
										?>
										<img class="thumb-item" src="<?php echo $url; ?>">
										<span class="thumb-price"><?php echo '+'.$currency_symbol.number_format((float) Mage::helper('directory')->currencyConvert($v->getPrice(), $baseCurrencyCode, $currentCurrencyCode), 2, '.', ''); ?></span>
									</li>
								<?php endforeach; ?>
								</ul>
								<script>
									jQuery(document).ready(function($){
										$('.foilColourEmbossed .item').hover(function ($) {
											jQuery('.foilColourEmbossed .item').removeClass('hovered');
											jQuery(this).addClass('hovered');
										});
										$('.foilColourEmbossed .item').mouseleave(function ($) {
											jQuery('.foilColourEmbossed .item').removeClass('hovered');
										});
										$('.foilColourEmbossed .item').click(function ($) {
											var foilSelectObjId = '#select_' + foilEmbossedOptionId;
											jQuery(foilSelectObjId).val(jQuery(this).attr('id'));
											opConfig.reloadPrice();
											jQuery('.foilColourEmbossed .item').removeClass('selected');
											jQuery(this).addClass('selected');
											//jQuery('.additional-note').show();
											jQuery('.add-to-cart-wrapper').show();
											if (index == totalCount) {
												jQuery('.add-to-cart-wrapper').show();
											} else {
												jQuery('.custom-options .row').eq(index + 2).show();
												index++;
											}
										});
									});
								</script>
							</div>
							<?php endif; ?>
							<?php if ($additionalNoteOptionId > 0) : ?>
							<div class="row additional-note">
								<h4>Additional Notes</h4>
								<input type="text" id="additional_notes" />
								<script>
									jQuery(document).ready(function($){
										$('#additional_notes').change(function ($) {
											jQuery('.add-to-cart-wrapper').show();
											var additionalObjId = '#options_' + additionalNoteOptionId + '_text';
											jQuery(additionalObjId).val(jQuery(this).val());
										});
									});
								</script>
							</div>
							<?php endif; ?>
						</div>
					</div>
				<?php else : ?>
					<script>
						jQuery(document).ready(function($){
							$('.product-view.customlayout .add-to-cart-wrapper').show();
						});
					</script>
				<?php endif; ?>
				
				<div class="add-to-cart-wrapper">
					<p style="font-family: cera-bold;">Calculated Price is <span id="totalPrice"></span> / Item</p>
					<input type="hidden" name="custom_total_price" id="custom_total_price" value="0" />
					<?php echo $this->getChildHtml('product_type_data') ?>
					<?php echo $this->getChildHtml('extrahint') ?>

					<?php echo $this->getChildHtml('addtocart') ?>
					<?php if (!$this->hasOptions()):?>
						<div class="add-to-box">
							<?php if($_product->isSaleable()): ?>
								<?php echo $this->getChildHtml('addtocart') ?>
								<?php if( $this->helper('wishlist')->isAllow() || $_compareUrl=$this->helper('catalog/product_compare')->getAddUrl($_product)): ?>
									<span class="or"><?php echo $this->__('OR') ?></span>
								<?php endif; ?>
							<?php endif; ?>
							<?php echo $this->getChildHtml('addto') ?>
							<?php echo $this->getChildHtml('sharing') ?>
						</div>
						<!-- Cart2Quote button -->
                
						<?php echo $this->getChildHtml('extra_buttons') ?>
					<?php elseif (!$_product->isSaleable()): ?>
						<div class="add-to-box">
							<?php echo $this->getChildHtml('addto') ?>
							<?php echo $this->getChildHtml('sharing') ?>
						</div>
					<?php endif; ?>
					
					
					
				</div>



				<?php echo $this->getChildHtml('related_products') ?>

				<div class="clearer"></div>
				<?php if ($_product->isSaleable() && $this->hasOptions()):?>
					<?php echo $this->getChildChildHtml('container2', '', true, true) ?>
				<?php endif;?>
			</form>
			<script type="text/javascript">
			//<![CDATA[
				var productAddToCartForm = new VarienForm('product_addtocart_form');
				productAddToCartForm.submit = function(button, url) {
					if (this.validator.validate()) {
						var form = this.form;
						var oldUrl = form.action;

						if (url) {
						   form.action = url;
						}
						var e = null;
						try {
							this.form.submit();
						} catch (e) {
						}
						this.form.action = oldUrl;
						if (e) {
							throw e;
						}

						if (button && button != 'undefined') {
							button.disabled = true;
						}
					}
				}.bind(productAddToCartForm);

				productAddToCartForm.submitLight = function(button, url){
					if(this.validator) {
						var nv = Validation.methods;
						delete Validation.methods['required-entry'];
						delete Validation.methods['validate-one-required'];
						delete Validation.methods['validate-one-required-by-name'];
						// Remove custom datetime validators
						for (var methodName in Validation.methods) {
							if (methodName.match(/^validate-datetime-.*/i)) {
								delete Validation.methods[methodName];
							}
						}

						if (this.validator.validate()) {
							if (url) {
								this.form.action = url;
							}
							this.form.submit();
						}
						Object.extend(Validation.methods, nv);
					}
				}.bind(productAddToCartForm);
			//]]>
			</script>
		</div>
		<div class="thumbnail-modal" style="visibility: hidden">
			<img id="enlarge-thumbnail-image" src="" />
			<a id="close-button-thumbnail" href="#">Close</a>
		</div>
	</div>
<?php endif; ?>